var t=Object.defineProperty,e=(e,s,n)=>((e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n)(e,"symbol"!=typeof s?s+"":s,n);function s(){}function n(t){return t()}function o(){return Object.create(null)}function i(t){t.forEach(n)}function a(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t){return null==t?"":t}function r(t,e){t.appendChild(e)}function u(t,e,s){t.insertBefore(e,s||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function h(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}function f(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function p(){return m("")}function v(t,e,s,n){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s,n)}function b(t,e,s){null==s?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function y(t,e){e=""+e,t.data!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function C(t,e,s,n){null==s?t.style.removeProperty(e):t.style.setProperty(e,s,"")}function S(t,e,s){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e)return void(s.selected=!0)}t.selectedIndex=-1}let $;function M(t){$=t}function w(){if(!$)throw new Error("Function called outside component initialization");return $}function k(t){w().$$.on_mount.push(t)}function E(t){w().$$.on_destroy.push(t)}function _(){const t=w();return(e,s,{cancelable:n=!1}={})=>{const o=t.$$.callbacks[e];if(o){const i=function(t,e,{bubbles:s=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:s,cancelable:n})}(e,s,{cancelable:n});return o.slice().forEach(e=>{e.call(t,i)}),!i.defaultPrevented}return!0}}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const N=[],q=[];let j=[];const D=[],A=Promise.resolve();let T=!1;function R(){T||(T=!0,A.then(H))}function O(t){j.push(t)}const z=new Set;let F=0;function H(){if(0!==F)return;const t=$;do{try{for(;F<N.length;){const t=N[F];F++,M(t),V(t.$$)}}catch(e){throw N.length=0,F=0,e}for(M(null),N.length=0,F=0;q.length;)q.pop()();for(let t=0;t<j.length;t+=1){const e=j[t];z.has(e)||(z.add(e),e())}j.length=0}while(N.length);for(;D.length;)D.pop()();T=!1,z.clear(),M(t)}function V(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(O)}}const B=new Set;let G;function L(t,e){t&&t.i&&(B.delete(t),t.i(e))}function I(t,e,s,n){if(t&&t.o){if(B.has(t))return;B.add(t),G.c.push(()=>{B.delete(t),n&&(s&&t.d(1),n())}),t.o(e)}else n&&n()}function W(t){return void 0!==(null==t?void 0:t.length)?t:Array.from(t)}function P(t){t&&t.c()}function J(t,e,s){const{fragment:o,after_update:l}=t.$$;o&&o.m(e,s),O(()=>{const e=t.$$.on_mount.map(n).filter(a);t.$$.on_destroy?t.$$.on_destroy.push(...e):i(e),t.$$.on_mount=[]}),l.forEach(O)}function U(t,e){const s=t.$$;null!==s.fragment&&(!function(t){const e=[],s=[];j.forEach(n=>-1===t.indexOf(n)?e.push(n):s.push(n)),s.forEach(t=>t()),j=e}(s.after_update),i(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function K(t,e,n,a,l,c,r=null,u=[-1]){const h=$;M(t);const f=t.$$={fragment:null,ctx:[],props:c,update:s,not_equal:l,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:o(),dirty:u,skip_bound:!1,root:e.target||h.$$.root};r&&r(f.root);let m=!1;if(f.ctx=n?n(t,e.props||{},(e,s,...n)=>{const o=n.length?n[0]:s;return f.ctx&&l(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),m&&function(t,e){-1===t.$$.dirty[0]&&(N.push(t),R(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),s}):[],f.update(),m=!0,i(f.before_update),f.fragment=!!a&&a(f.ctx),e.target){if(e.hydrate){const t=(g=e.target,Array.from(g.childNodes));f.fragment&&f.fragment.l(t),t.forEach(d)}else f.fragment&&f.fragment.c();e.intro&&L(t.$$.fragment),J(t,e.target,e.anchor),H()}var g;M(h)}class X{constructor(){e(this,"$$"),e(this,"$$set")}$destroy(){U(this,1),this.$destroy=s}$on(t,e){if(!a(e))return s;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const Q=[{id:"song1",title:"ç”µå­èŠ‚æ‹",artist:"èŠ‚å¥å¤§å¸ˆ",duration:120,bpm:120,coverUrl:"https://via.placeholder.com/200?text=Electronic+Beat",audioUrl:"",description:"ä¸€é¦–å……æ»¡æ´»åŠ›çš„ç”µå­éŸ³ä¹ï¼Œé€‚åˆåˆå­¦è€…",difficulty:{easy:!0,normal:!0,hard:!1,expert:!1},notes:{easy:Y(120,3),normal:Z(120,4),hard:null,expert:null}},{id:"song2",title:"æ‘‡æ»šä¹‹æ—…",artist:"èŠ‚å¥å¤§å¸ˆ",duration:150,bpm:140,coverUrl:"https://via.placeholder.com/200?text=Rock+Journey",audioUrl:"",description:"æ¿€æƒ…å››å°„çš„æ‘‡æ»šæ­Œæ›²ï¼Œé€‚åˆä¸­çº§ç©å®¶",difficulty:{easy:!0,normal:!0,hard:!0,expert:!1},notes:{easy:Y(150,3),normal:Z(150,4),hard:tt(150,5),expert:null}},{id:"song3",title:"çˆµå£«é£æƒ…",artist:"èŠ‚å¥å¤§å¸ˆ",duration:180,bpm:100,coverUrl:"https://via.placeholder.com/200?text=Jazz+Mood",audioUrl:"",description:"ä¼˜é›…çš„çˆµå£«ä¹ï¼Œè€ƒéªŒèŠ‚å¥æ„Ÿ",difficulty:{easy:!1,normal:!0,hard:!0,expert:!0},notes:{easy:null,normal:Z(180,4),hard:tt(180,5),expert:et(180,6)}},{id:"song4",title:"å¤å…¸éŸµå¾‹",artist:"èŠ‚å¥å¤§å¸ˆ",duration:200,bpm:90,coverUrl:"https://via.placeholder.com/200?text=Classic+Rhythm",audioUrl:"",description:"ç»å…¸å¤å…¸éŸ³ä¹æ”¹ç¼–ï¼ŒèŠ‚å¥æ˜å¿«",difficulty:{easy:!0,normal:!0,hard:!0,expert:!0},notes:{easy:Y(200,3),normal:Z(200,4),hard:tt(200,5),expert:et(200,6)}},{id:"song5",title:"æœªæ¥ç§‘æŠ€",artist:"èŠ‚å¥å¤§å¸ˆ",duration:160,bpm:160,coverUrl:"https://via.placeholder.com/200?text=Future+Tech",audioUrl:"",description:"é«˜bpmç”µå­éŸ³ä¹ï¼ŒæŒ‘æˆ˜æé™ååº”",difficulty:{easy:!1,normal:!1,hard:!0,expert:!0},notes:{easy:null,normal:null,hard:tt(160,5),expert:et(160,6)}}];function Y(t,e){const s=[],n=Math.floor(.5*t);for(let o=0;o<n;o++)s.push({id:`note_easy_${o}`,lane:Math.floor(Math.random()*e),time:2*o,duration:0});return s}function Z(t,e){const s=[],n=Math.floor(.8*t);for(let o=0;o<n;o++){const t=Math.random()<.1;s.push({id:`note_normal_${o}`,lane:Math.floor(Math.random()*e),time:1.25*o+.5*Math.random(),duration:t?1+2*Math.random():0})}return s}function tt(t,e){const s=[],n=Math.floor(1.5*t);for(let o=0;o<n;o++){const t=Math.random()<.15;s.push({id:`note_hard_${o}`,lane:Math.floor(Math.random()*e),time:.67*o+.3*Math.random(),duration:t?.5+1.5*Math.random():0})}return st(s,e,t),s.sort((t,e)=>t.time-e.time)}function et(t,e){const s=[],n=Math.floor(2.5*t);for(let o=0;o<n;o++){const t=Math.random()<.2;s.push({id:`note_expert_${o}`,lane:Math.floor(Math.random()*e),time:.4*o+.2*Math.random(),duration:t?.3+1*Math.random():0})}return st(s,e,t,!0),s.sort((t,e)=>t.time-e.time)}function st(t,e,s,n=!1){const o=n?8:5;for(let i=0;i<o;i++){const o=Math.random()*(s-10);switch(Math.floor(3*Math.random())){case 0:for(let e=0;e<(n?8:5);e++){const s=e%2;t.push({id:`pattern_alternate_${i}_${e}`,lane:s,time:o+.2*e,duration:0})}break;case 1:for(let s=0;s<e;s++)t.push({id:`pattern_stair_${i}_${s}`,lane:s,time:o+.15*s,duration:0});break;case 2:for(let s=0;s<(n?10:6);s++)t.push({id:`pattern_dense_${i}_${s}`,lane:Math.floor(Math.random()*e),time:o+.12*s,duration:0})}}}function nt(t,e,s){const n=t.slice();return n[16]=e[s],n}function ot(t,e,s){const n=t.slice();return n[13]=e[s],n}function it(t){let e,s,n,o,i,a,l,c,p,x,C=t[0].title+"",S=W(["easy","normal","hard"]),$=[];for(let r=0;r<3;r+=1)$[r]=ct(nt(t,S,r));return{c(){e=f("section"),s=f("button"),s.textContent="â† è¿”å›æ­Œæ›²é€‰æ‹©",n=g(),o=f("h3"),i=m("é€‰æ‹©éš¾åº¦ - "),a=m(C),l=g(),c=f("div");for(let t=0;t<3;t+=1)$[t].c();b(s,"class","back-button svelte-1fbelno"),b(o,"class","section-title svelte-1fbelno"),b(c,"class","difficulty-options svelte-1fbelno"),b(e,"class","difficulty-selection svelte-1fbelno")},m(d,h){u(d,e,h),r(e,s),r(e,n),r(e,o),r(o,i),r(o,a),r(e,l),r(e,c);for(let t=0;t<3;t+=1)$[t]&&$[t].m(c,null);p||(x=v(s,"click",t[7]),p=!0)},p(t,e){if(1&e&&C!==(C=t[0].title+"")&&y(a,C),65&e){let s;for(S=W(["easy","normal","hard"]),s=0;s<3;s+=1){const n=nt(t,S,s);$[s]?$[s].p(n,e):($[s]=ct(n),$[s].c(),$[s].m(c,null))}for(;s<3;s+=1)$[s].d(1)}},d(t){t&&d(e),h($,t),p=!1,x()}}}function at(t){let e,s,n,o,i=W(t[4]),a=[];for(let l=0;l<i.length;l+=1)a[l]=rt(ot(t,i,l));return{c(){e=f("section"),s=f("h3"),s.textContent="é€‰æ‹©æ­Œæ›²",n=g(),o=f("div");for(let t=0;t<a.length;t+=1)a[t].c();b(s,"class","section-title svelte-1fbelno"),b(o,"class","songs-grid svelte-1fbelno"),b(e,"class","song-selection svelte-1fbelno")},m(t,i){u(t,e,i),r(e,s),r(e,n),r(e,o);for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(o,null)},p(t,e){if(49&e){let s;for(i=W(t[4]),s=0;s<i.length;s+=1){const n=ot(t,i,s);a[s]?a[s].p(n,e):(a[s]=rt(n),a[s].c(),a[s].m(o,null))}for(;s<a.length;s+=1)a[s].d(1);a.length=i.length}},d(t){t&&d(e),h(a,t)}}}function lt(t){let e,s,n,o,i,a,l,h,p,x,C,S,$,M=(t[0].notes[t[16]]?t[0].notes[t[16]].length:"N/A")+"";function w(){return t[10](t[16])}return{c(){e=f("button"),s=f("div"),n=f("span"),n.textContent=""+("easy"===t[16]?"ç®€å•":"normal"===t[16]?"ä¸­ç­‰":"hard"===t[16]?"å›°éš¾":"ä¸“å®¶"),o=g(),i=f("span"),i.textContent=`${dt("easy"===t[16]?3:"normal"===t[16]?4:"hard"===t[16]?5:6)}`,a=g(),l=f("div"),h=f("span"),p=m("éŸ³ç¬¦æ•°é‡: "),x=m(M),C=g(),b(n,"class","difficulty-name svelte-1fbelno"),b(i,"class","difficulty-level svelte-1fbelno"),b(s,"class","difficulty-header svelte-1fbelno"),b(l,"class","difficulty-info svelte-1fbelno"),b(e,"class",c(`difficulty-button ${t[16]}`)+" svelte-1fbelno")},m(t,c){u(t,e,c),r(e,s),r(s,n),r(s,o),r(s,i),r(e,a),r(e,l),r(l,h),r(h,p),r(h,x),r(e,C),S||($=v(e,"click",w),S=!0)},p(e,s){t=e,1&s&&M!==(M=(t[0].notes[t[16]]?t[0].notes[t[16]].length:"N/A")+"")&&y(x,M)},d(t){t&&d(e),S=!1,$()}}}function ct(t){let e,s=t[0].difficulty[t[16]]&&lt(t);return{c(){s&&s.c(),e=p()},m(t,n){s&&s.m(t,n),u(t,e,n)},p(t,n){t[0].difficulty[t[16]]?s?s.p(t,n):(s=lt(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(t){t&&d(e),s&&s.d(t)}}}function rt(t){let e,s,n,o,i,a,l,h,m,p,y,x,C,S,$,M,w;function k(){return t[9](t[13])}return{c(){e=f("div"),s=f("div"),n=f("div"),n.textContent=`${t[13].title?t[13].title.charAt(0):"?"}`,o=g(),i=f("div"),a=f("h4"),a.textContent=`${t[13].title}`,l=g(),h=f("p"),h.textContent=`${t[13].artist}`,m=g(),p=f("div"),y=f("span"),y.textContent="éš¾åº¦èŒƒå›´:",x=g(),C=f("span"),C.textContent=`${t[13].difficulty.easy?dt(3):"N/A"} ~ ${t[13].difficulty.expert?dt(6):t[13].difficulty.hard?dt(5):t[13].difficulty.normal?dt(4):"N/A"}`,S=g(),b(n,"class","cover-placeholder svelte-1fbelno"),b(s,"class","song-cover svelte-1fbelno"),b(a,"class","song-title svelte-1fbelno"),b(h,"class","song-artist svelte-1fbelno"),b(y,"class","difficulty-label"),b(C,"class","difficulty-stars svelte-1fbelno"),b(p,"class","song-difficulty svelte-1fbelno"),b(i,"class","song-info"),b(e,"class",$=c("song-card "+(t[0].id===t[13].id?"selected":""))+" svelte-1fbelno")},m(t,c){u(t,e,c),r(e,s),r(s,n),r(e,o),r(e,i),r(i,a),r(i,l),r(i,h),r(i,m),r(i,p),r(p,y),r(p,x),r(p,C),r(e,S),M||(w=v(e,"click",k),M=!0)},p(s,n){t=s,1&n&&$!==($=c("song-card "+(t[0].id===t[13].id?"selected":""))+" svelte-1fbelno")&&b(e,"class",$)},d(t){t&&d(e),M=!1,w()}}}function ut(t){let e,n,o,i,a,l,h,m,p,y,x;function C(t,e){return t[1]?it:at}let S=C(t),$=S(t);return{c(){e=f("div"),n=f("header"),n.innerHTML='<h1 class="game-title svelte-1fbelno">èŠ‚å¥å¤§å¸ˆ</h1> <h2 class="game-subtitle svelte-1fbelno">Rhythm Master</h2>',o=g(),$.c(),i=g(),a=f("footer"),l=f("button"),l.textContent="è®¾ç½®",h=g(),m=f("p"),m.textContent="Â© 2024 èŠ‚å¥å¤§å¸ˆ - Rhythm Master",b(n,"class","game-header svelte-1fbelno"),b(l,"class","settings-button svelte-1fbelno"),b(m,"class","copyright svelte-1fbelno"),b(a,"class","home-footer svelte-1fbelno"),b(e,"class",p=c("home-container "+(t[2]?"fade-in":""))+" svelte-1fbelno")},m(s,c){u(s,e,c),r(e,n),r(e,o),$.m(e,null),r(e,i),r(e,a),r(a,l),r(a,h),r(a,m),y||(x=v(l,"click",t[11]),y=!0)},p(t,[s]){S===(S=C(t))&&$?$.p(t,s):($.d(1),$=S(t),$&&($.c(),$.m(e,i))),4&s&&p!==(p=c("home-container "+(t[2]?"fade-in":""))+" svelte-1fbelno")&&b(e,"class",p)},i:s,o:s,d(t){t&&d(e),$.d(),y=!1,x()}}}function dt(t){return"â˜…".repeat(Math.min(t,10))}function ht(t,e,s){const n=_();let{gameConfig:o}=e,i=Q,a=i.length>0?i[0]:null,l=!1,c=!1;function r(t){s(0,a=t),s(1,l=!0)}function u(t){n("startGame",{song:a,difficulty:t})}k(()=>{setTimeout(()=>{s(2,c=!0)},100)});return t.$$set=t=>{"gameConfig"in t&&s(8,o=t.gameConfig)},[a,l,c,n,i,r,u,function(){s(1,l=!1)},o,t=>r(t),t=>u(t),()=>n("settings")]}class ft extends X{constructor(t){super(),K(this,t,ht,ut,l,{gameConfig:8})}}const mt=new class{constructor(){this.bgm=null,this.soundEffects={},this.volume={bgm:.7,sfx:.9},this.isMuted={bgm:!1,sfx:!1}}setBGM(t){return this.bgm&&(this.bgm.pause(),this.bgm=null),this.bgm=new Audio(t),this.bgm.loop=!0,this.bgm.volume=this.isMuted.bgm?0:this.volume.bgm,this.bgm}playBGM(){this.bgm&&this.bgm.paused&&this.bgm.play().catch(t=>{console.warn("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:",t)})}pauseBGM(){this.bgm&&!this.bgm.paused&&this.bgm.pause()}stopBGM(){this.bgm&&(this.bgm.pause(),this.bgm.currentTime=0)}loadSoundEffect(t,e){const s=new Audio(e);return s.volume=this.isMuted.sfx?0:this.volume.sfx,this.soundEffects[t]=s,s}playSoundEffect(t,e=!1){if(!this.soundEffects[t])return void console.warn(`éŸ³æ•ˆ ${t} æœªåŠ è½½`);const s=this.soundEffects[t].cloneNode(!0);return s.loop=e,s.volume=this.isMuted.sfx?0:this.volume.sfx,s.play().catch(e=>{console.warn(`éŸ³æ•ˆ ${t} æ’­æ”¾å¤±è´¥:`,e)}),s.addEventListener("ended",()=>{s.remove()}),s}setBGMVolume(t){this.volume.bgm=Math.max(0,Math.min(1,t)),this.bgm&&(this.bgm.volume=this.isMuted.bgm?0:this.volume.bgm)}setSFXVolume(t){this.volume.sfx=Math.max(0,Math.min(1,t));for(const e in this.soundEffects)this.soundEffects[e].volume=this.isMuted.sfx?0:this.volume.sfx}toggleBGMMute(){return this.isMuted.bgm=!this.isMuted.bgm,this.bgm&&(this.bgm.volume=this.isMuted.bgm?0:this.volume.bgm),this.isMuted.bgm}toggleSFXMute(){this.isMuted.sfx=!this.isMuted.sfx;const t=this.isMuted.sfx?0:this.volume.sfx;for(const e in this.soundEffects)this.soundEffects[e].volume=t;return this.isMuted.sfx}getSettings(){return{volume:{...this.volume},isMuted:{...this.isMuted}}}applySettings(t){t.volume&&("number"==typeof t.volume.bgm&&this.setBGMVolume(t.volume.bgm),"number"==typeof t.volume.sfx&&this.setSFXVolume(t.volume.sfx)),t.isMuted&&("boolean"==typeof t.isMuted.bgm&&this.isMuted.bgm!==t.isMuted.bgm&&this.toggleBGMMute(),"boolean"==typeof t.isMuted.sfx&&this.isMuted.sfx!==t.isMuted.sfx&&this.toggleSFXMute())}};const gt=new class{constructor(){this.storageKey="rhythm_master_data",this.defaultSettings={audio:{bgmEnabled:!0,sfxEnabled:!0,bgmVolume:.7,sfxVolume:.9},gameplay:{noteSpeed:100,noteSize:40,trackCount:4,hitWindow:50},display:{fullscreen:!1,theme:"default"},difficulty:"normal"},this.loadData()}loadData(){try{const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);this.settings=e.settings||{...this.defaultSettings},this.highScores=e.highScores||{},this.stats=e.stats||this._getDefaultStats()}else this.resetData()}catch(t){console.warn("åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥:",t),this.resetData()}}saveData(){try{const t={settings:this.settings,highScores:this.highScores,stats:this.stats,lastUpdated:(new Date).toISOString()};return localStorage.setItem(this.storageKey,JSON.stringify(t)),!0}catch(t){return console.warn("ä¿å­˜æ¸¸æˆæ•°æ®å¤±è´¥:",t),!1}}resetData(){this.settings={...this.defaultSettings},this.highScores={},this.stats=this._getDefaultStats(),this.saveData()}_getDefaultStats(){return{totalGames:0,totalNotesHit:0,totalNotesMissed:0,totalScore:0,maxComboEver:0,favoriteSong:null,favoriteDifficulty:null,playTime:0,lastPlayed:null}}getSettings(){return{...this.settings}}updateSettings(t){return this.settings={...this.settings,...t},t.audio&&(this.settings.audio={...this.settings.audio,...t.audio}),t.gameplay&&(this.settings.gameplay={...this.settings.gameplay,...t.gameplay}),t.display&&(this.settings.display={...this.settings.display,...t.display}),this.saveData()}getHighScore(t,e){const s=`${t}_${e}`;return this.highScores[s]||0}updateHighScore(t,e,s){const n=`${t}_${e}`;return s>(this.highScores[n]||0)&&(this.highScores[n]=s,this.saveData(),!0)}getAllHighScores(){return{...this.highScores}}clearHighScoresForSong(t){Object.keys(this.highScores).forEach(e=>{e.startsWith(t+"_")&&delete this.highScores[e]}),this.saveData()}clearAllHighScores(){this.highScores={},this.saveData()}updateGameStats(t){t&&(this.stats.totalGames+=1,t.totalNotes&&(this.stats.totalNotesHit+=t.hitNotes||0,this.stats.totalNotesMissed+=t.missCount||0),t.score&&(this.stats.totalScore+=t.score),t.maxCombo&&t.maxCombo>this.stats.maxComboEver&&(this.stats.maxComboEver=t.maxCombo),t.songId&&(this.stats.favoriteSong=t.songId),t.difficulty&&(this.stats.favoriteDifficulty=t.difficulty),t.playTime&&(this.stats.playTime+=t.playTime),this.stats.lastPlayed=(new Date).toISOString(),this.saveData())}getStats(){return{...this.stats}}exportData(){const t={settings:this.settings,highScores:this.highScores,stats:this.stats,exportDate:(new Date).toISOString(),version:"1.0"};return JSON.stringify(t,null,2)}importData(t){try{const e=JSON.parse(t);return e.settings&&(this.settings=e.settings),e.highScores&&(this.highScores=e.highScores),e.stats&&(this.stats=e.stats),this.saveData(),!0}catch(e){return console.warn("å¯¼å…¥æ¸¸æˆæ•°æ®å¤±è´¥:",e),!1}}};new class{constructor(){this.notes=[],this.noteSpeed=100,this.noteSize=40,this.trackCount=4,this.noteSpawnRate=.5,this.laneWidth=80,this.currentTime=0,this.difficulty="normal",this.syncWithGameConfig()}syncWithGameConfig(){const t=gt.getSettings();this.trackCount=(null==t?void 0:t.trackCount)||this.trackCount,this.noteSpeed=(null==t?void 0:t.noteSpeed)||this.noteSpeed}init(t={}){this.syncWithGameConfig(),this.noteSpeed=t.noteSpeed||this.noteSpeed,this.noteSize=t.noteSize||this.noteSize,this.trackCount=t.trackCount||this.trackCount,this.laneWidth=t.laneWidth||this.laneWidth,this.difficulty=t.difficulty||this.difficulty,this._adjustForDifficulty(),this.clearNotes(),this.currentTime=0,gt.updateSettings({noteSpeed:this.noteSpeed,trackCount:this.trackCount})}_adjustForDifficulty(){const t=gt.getSettings()||{};switch(this.difficulty){case"easy":this.noteSpeed=t.noteSpeed||80,this.noteSpawnRate=.3,this.trackCount=t.trackCount||3;break;case"normal":this.noteSpeed=t.noteSpeed||100,this.noteSpawnRate=.5,this.trackCount=t.trackCount||4;break;case"hard":this.noteSpeed=t.noteSpeed||120,this.noteSpawnRate=.7,this.trackCount=t.trackCount||5;break;case"expert":this.noteSpeed=t.noteSpeed||150,this.noteSpawnRate=.9,this.trackCount=t.trackCount||6}}update(t,e){this.currentTime+=t;for(let s=0;s<this.notes.length;s++){const n=this.notes[s];n.y+=this.noteSpeed*t,n.y>e+this.noteSize&&(this.notes.splice(s,1),s--)}}spawnRandomNote(t){if(Math.random()<this.noteSpawnRate){const t=Math.floor(Math.random()*this.trackCount),e=t*this.laneWidth+(this.laneWidth-this.noteSize)/2,s={id:Date.now()+Math.random(),lane:t,x:e,y:-this.noteSize,size:this.noteSize,hit:!1,hitTime:null};return this.notes.push(s),s}return null}spawnNoteAtLane(t,e){if(t<0||t>=this.trackCount)return null;const s=t*this.laneWidth+(this.laneWidth-this.noteSize)/2,n={id:Date.now()+Math.random(),lane:t,x:s,y:-this.noteSize,size:this.noteSize,hit:!1,hitTime:null};return this.notes.push(n),n}generateNotesFromSong(t,e){this.clearNotes(),t&&t.notes&&t.notes.forEach(t=>{const e=t.lane;if(e<0||e>=this.trackCount)return;const s=e*this.laneWidth+(this.laneWidth-this.noteSize)/2,n={id:t.id||Date.now()+Math.random(),lane:e,x:s,y:-this.noteSize,size:this.noteSize,hit:!1,hitTime:null,startTime:t.time,holdDuration:t.duration||0};this.notes.push(n)})}checkHit(t,e,s=50){const n=this.notes.filter(n=>!n.hit&&n.lane===t&&Math.abs(n.y-e)<s);if(0===n.length)return null;n.sort((t,s)=>Math.abs(t.y-e)-Math.abs(s.y-e));const o=n[0];o.hit=!0,o.hitTime=this.currentTime;const i=Math.abs(o.y-e);let a;return a=i<.2*s?"perfect":i<.4*s?"great":i<.6*s?"good":"miss",{note:o,accuracy:a,distance:i}}clearNotes(){this.notes=[]}getNotes(){return this.notes}getNotesByLane(t){return this.notes.filter(e=>e.lane===t&&!e.hit)}setNoteSpeed(t){this.noteSpeed=Math.max(50,Math.min(200,t))}setNoteSize(t){this.noteSize=Math.max(20,Math.min(100,t)),this.notes.forEach(t=>{t.size=this.noteSize})}setTrackCount(t){this.trackCount=Math.max(3,Math.min(8,t))}setDifficulty(t){["easy","normal","hard","expert"].includes(t)&&(this.difficulty=t,this._adjustForDifficulty())}};function pt(t,e,s){const n=t.slice();return n[50]=e[s],n[52]=s,n}function vt(t,e,s){const n=t.slice();return n[53]=e[s],n}function bt(t){let e,n,o,a,l,c,h,m;return{c(){e=f("div"),n=f("h2"),n.textContent="æ¸¸æˆæš‚åœ",o=g(),a=f("button"),a.textContent="ç»§ç»­æ¸¸æˆ",l=g(),c=f("button"),c.textContent="é€€å‡ºæ¸¸æˆ",b(n,"class","pause-text svelte-1mf5w9"),b(a,"class","resume-button svelte-1mf5w9"),b(c,"class","exit-button svelte-1mf5w9"),b(e,"class","pause-overlay svelte-1mf5w9")},m(s,i){u(s,e,i),r(e,n),r(e,o),r(e,a),r(e,l),r(e,c),h||(m=[v(a,"click",t[14]),v(c,"click",t[18])],h=!0)},p:s,d(t){t&&d(e),h=!1,i(m)}}}function yt(t){let e,s,n,o,i;return{c(){e=f("div"),s=f("div"),n=g(),b(s,"class","note-inner svelte-1mf5w9"),b(e,"class",o=c(`note lane-${t[53].lane} ${t[53].judgment?t[53].judgment:""}`)+" svelte-1mf5w9"),b(e,"style",i=`\n            left: ${t[53].lane/t[12]*100}%;\n            top: ${t[53].position}px;\n            width: ${2*t[13]}px;\n            height: ${2*t[13]}px;\n          `)},m(t,o){u(t,e,o),r(e,s),r(e,n)},p(t,s){32&s[0]&&o!==(o=c(`note lane-${t[53].lane} ${t[53].judgment?t[53].judgment:""}`)+" svelte-1mf5w9")&&b(e,"class",o),32&s[0]&&i!==(i=`\n            left: ${t[53].lane/t[12]*100}%;\n            top: ${t[53].position}px;\n            width: ${2*t[13]}px;\n            height: ${2*t[13]}px;\n          `)&&b(e,"style",i)},d(t){t&&d(e)}}}function xt(t){let e,s=t[53].createdAt&&!t[53].hit&&yt(t);return{c(){s&&s.c(),e=p()},m(t,n){s&&s.m(t,n),u(t,e,n)},p(t,n){t[53].createdAt&&!t[53].hit?s?s.p(t,n):(s=yt(t),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(t){t&&d(e),s&&s.d(t)}}}function Ct(t){let e,s,n,o,a,l,c;function h(){return t[20](t[52])}function m(){return t[21](t[52])}return{c(){e=f("div"),s=f("div"),n=g(),o=f("span"),o.textContent=""+(0===t[52]?"D/1":1===t[52]?"F/2":2===t[52]?"J/3":"K/4"),a=g(),b(s,"class","touch-feedback svelte-1mf5w9"),b(o,"class","key-hint svelte-1mf5w9"),b(e,"class","touch-area svelte-1mf5w9"),C(e,"width",100/t[12]+"%")},m(t,i){u(t,e,i),r(e,s),r(e,n),r(e,o),r(e,a),l||(c=[v(e,"touchstart",h,{passive:!0}),v(e,"click",m)],l=!0)},p(e,s){t=e},d(t){t&&d(e),l=!1,i(c)}}}function St(t){let e,n,o,a,l,p,x,C,S,$,M,w,k,E,_,N,q,j,D,A,T,R,O,z,F,H,V,B,G,L,I,P,J,U,K,X,Q,Y,Z,tt,et,st,nt,ot,it,at,lt,ct,rt,ut,dt,ht,ft,mt,gt=t[0].title+"",yt=t[0].artist+"",St="easy"===t[1]?"ç®€å•":"medium"===t[1]?"ä¸­ç­‰":"å›°éš¾",wt=t[2].toLocaleString()+"",kt=Mt(t[7])+"",Et=t[6]?"â–¶":"âšâš",_t=t[6]&&bt(t),Nt=W(t[5]),qt=[];for(let s=0;s<Nt.length;s+=1)qt[s]=xt(vt(t,Nt,s));let jt=W(Array(t[12])),Dt=[];for(let s=0;s<jt.length;s+=1)Dt[s]=Ct(pt(t,jt,s));return{c(){e=f("div"),_t&&_t.c(),n=g(),o=f("div"),a=f("div"),l=f("h3"),p=m(gt),x=g(),C=f("p"),S=m(yt),$=g(),M=f("span"),w=m(St),k=g(),E=f("div"),_=f("div"),N=f("span"),N.textContent="åˆ†æ•°:",q=g(),j=f("span"),D=m(wt),A=g(),T=f("div"),R=f("span"),R.textContent="è¿å‡»:",O=g(),z=f("span"),F=m(t[3]),V=g(),B=f("div"),G=f("span"),G.textContent="å‡†ç¡®ç‡:",L=g(),I=f("span"),P=m(t[4]),J=m("%"),U=g(),K=f("div"),X=f("span"),Q=m(kt),Y=g(),Z=f("span"),Z.textContent="/",tt=g(),et=f("span"),et.textContent=`${Mt(1e3*$t)}`,st=g(),nt=f("div"),ot=f("div"),ot.innerHTML='<div class="judgment-line-glow svelte-1mf5w9"></div>',it=m("\n    >\n    \n    ");for(let t=0;t<qt.length;t+=1)qt[t].c();at=m("\n    >\n    \n    "),lt=f("div");for(let t=0;t<Dt.length;t+=1)Dt[t].c();ct=g(),rt=f("button"),ut=m(Et),dt=g(),ht=f("button"),ht.textContent="é€€å‡º",b(l,"class","current-song svelte-1mf5w9"),b(C,"class","song-artist svelte-1mf5w9"),b(M,"class","difficulty svelte-1mf5w9"),b(a,"class","song-info svelte-1mf5w9"),b(N,"class","stat-label svelte-1mf5w9"),b(j,"class","stat-value score svelte-1mf5w9"),b(_,"class","stat-item svelte-1mf5w9"),b(R,"class","stat-label svelte-1mf5w9"),b(z,"class",H=c("stat-value combo "+(t[3]>20?"glow":""))+" svelte-1mf5w9"),b(T,"class","stat-item svelte-1mf5w9"),b(G,"class","stat-label svelte-1mf5w9"),b(I,"class","stat-value accuracy svelte-1mf5w9"),b(B,"class","stat-item svelte-1mf5w9"),b(E,"class","game-stats svelte-1mf5w9"),b(X,"class","current-time"),b(Z,"class","separator"),b(et,"class","total-time"),b(K,"class","time-display svelte-1mf5w9"),b(o,"class","game-info svelte-1mf5w9"),b(ot,"class","judgment-line svelte-1mf5w9"),b(lt,"class","touch-areas svelte-1mf5w9"),b(nt,"class","game-area svelte-1mf5w9"),b(rt,"class","pause-button svelte-1mf5w9"),b(ht,"class","exit-game-button svelte-1mf5w9"),b(e,"class","game-page svelte-1mf5w9")},m(s,i){u(s,e,i),_t&&_t.m(e,null),r(e,n),r(e,o),r(o,a),r(a,l),r(l,p),r(a,x),r(a,C),r(C,S),r(a,$),r(a,M),r(M,w),r(o,k),r(o,E),r(E,_),r(_,N),r(_,q),r(_,j),r(j,D),r(E,A),r(E,T),r(T,R),r(T,O),r(T,z),r(z,F),r(E,V),r(E,B),r(B,G),r(B,L),r(B,I),r(I,P),r(I,J),r(o,U),r(o,K),r(K,X),r(X,Q),r(K,Y),r(K,Z),r(K,tt),r(K,et),r(e,st),r(e,nt),r(nt,ot),t[19](ot),r(nt,it);for(let t=0;t<qt.length;t+=1)qt[t]&&qt[t].m(nt,null);r(nt,at),r(nt,lt);for(let t=0;t<Dt.length;t+=1)Dt[t]&&Dt[t].m(lt,null);t[22](nt),r(e,ct),r(e,rt),r(rt,ut),r(e,dt),r(e,ht),t[24](e),ft||(mt=[v(rt,"click",t[14]),v(ht,"click",t[23]),v(e,"keydown",t[15])],ft=!0)},p(t,s){if(t[6]?_t?_t.p(t,s):(_t=bt(t),_t.c(),_t.m(e,n)):_t&&(_t.d(1),_t=null),1&s[0]&&gt!==(gt=t[0].title+"")&&y(p,gt),1&s[0]&&yt!==(yt=t[0].artist+"")&&y(S,yt),2&s[0]&&St!==(St="easy"===t[1]?"ç®€å•":"medium"===t[1]?"ä¸­ç­‰":"å›°éš¾")&&y(w,St),4&s[0]&&wt!==(wt=t[2].toLocaleString()+"")&&y(D,wt),8&s[0]&&y(F,t[3]),8&s[0]&&H!==(H=c("stat-value combo "+(t[3]>20?"glow":""))+" svelte-1mf5w9")&&b(z,"class",H),16&s[0]&&y(P,t[4]),128&s[0]&&kt!==(kt=Mt(t[7])+"")&&y(Q,kt),12320&s[0]){let e;for(Nt=W(t[5]),e=0;e<Nt.length;e+=1){const n=vt(t,Nt,e);qt[e]?qt[e].p(n,s):(qt[e]=xt(n),qt[e].c(),qt[e].m(nt,at))}for(;e<qt.length;e+=1)qt[e].d(1);qt.length=Nt.length}if(69632&s[0]){let e;for(jt=W(Array(t[12])),e=0;e<jt.length;e+=1){const n=pt(t,jt,e);Dt[e]?Dt[e].p(n,s):(Dt[e]=Ct(n),Dt[e].c(),Dt[e].m(lt,null))}for(;e<Dt.length;e+=1)Dt[e].d(1);Dt.length=jt.length}64&s[0]&&Et!==(Et=t[6]?"â–¶":"âšâš")&&y(ut,Et)},i:s,o:s,d(s){s&&d(e),_t&&_t.d(),t[19](null),h(qt,s),h(Dt,s),t[22](null),t[24](null),ft=!1,i(mt)}}}new class{constructor(){this.reset(),this.scoreMultiplier=1,this.comboMultiplier=.1,this.difficultyMultiplier={easy:.8,normal:1,hard:1.5,expert:2}}reset(){this.score=0,this.combo=0,this.maxCombo=0,this.perfectCount=0,this.greatCount=0,this.goodCount=0,this.missCount=0,this.accuracy=100,this.totalNotes=0,this.hitNotes=0,this.lastHitTime=0}handleHit(t,e=1e3,s="normal"){const n=this.difficultyMultiplier[s]||1;let o=0;switch(t){case"perfect":o=1*e,this.perfectCount++,this.combo++,this.hitNotes++;break;case"great":o=.8*e,this.greatCount++,this.combo++,this.hitNotes++;break;case"good":o=.5*e,this.goodCount++,this.combo++,this.hitNotes++;break;default:o=0,this.missCount++,this.combo=0}this.totalNotes++;const i=1+(this.combo-1)*this.comboMultiplier,a=Math.floor(o*this.scoreMultiplier*i*n);return this.score+=a,this.combo>this.maxCombo&&(this.maxCombo=this.combo),this.updateAccuracy(),{points:a,totalScore:this.score,combo:this.combo,maxCombo:this.maxCombo}}updateAccuracy(){if(0===this.totalNotes)return void(this.accuracy=100);const t=3*this.perfectCount+2*this.greatCount+1*this.goodCount+0*this.missCount,e=3*this.totalNotes;this.accuracy=e>0?Math.min(100,t/e*100):100}getRank(){if(0===this.totalNotes)return"F";const t=.5*(this.score/(1e3*this.totalNotes*2))+.3*(this.accuracy/100)+.2*(this.maxCombo/Math.max(1,this.totalNotes));return t>=.95?"S":t>=.85?"A":t>=.75?"B":t>=.65?"C":t>=.5?"D":"F"}setScoreMultiplier(t){this.scoreMultiplier=Math.max(.1,Math.min(5,t))}addComboMultiplier(t){this.comboMultiplier=Math.min(.5,this.comboMultiplier+t)}getStats(){return{score:this.score,combo:this.combo,maxCombo:this.maxCombo,perfectCount:this.perfectCount,greatCount:this.greatCount,goodCount:this.goodCount,missCount:this.missCount,accuracy:this.accuracy,totalNotes:this.totalNotes,hitNotes:this.hitNotes,rank:this.getRank()}}isNewHighScore(t){return this.score>t}calculateComboBonus(t){return{10:1e3,50:5e3,100:1e4,200:25e3,300:5e4,500:1e5}[t]||0}handleComboMilestone(t){const e=this.calculateComboBonus(t);return e>0?(this.score+=e,e):0}};let $t=180;function Mt(t){const e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function wt(t,e,s){const n=_();let o,i,a,{song:l}=e,{difficulty:c}=e,{gameConfig:r}=e,u=0,d=0,h=0,f=100,m={perfect:0,great:0,good:0,bad:0,miss:0},g=[],p=!1,v=!1,b=0,y=null;const x=r.laneCount||4;r.speed;const C=r.noteRadius||20,S=50,$=100,M=150,w=200,N={perfect:1e3,great:700,good:400,bad:100,miss:0};let j=null;function D(){if(!p||v)return;const t=Date.now();s(7,b=t-y),function(){const t=i.offsetHeight,e=2e3;g.forEach(s=>{if(!s.createdAt&&b>=s.timing-e&&(s.createdAt=b),s.createdAt&&!s.hit){const n=b-s.createdAt;s.position=n/e*t}})}(),function(){const t=.8*i.offsetHeight+50;g.forEach(e=>{e.createdAt&&!e.hit&&e.position>t&&function(t){if(t.hit)return;t.hit=!0,t.judgment="miss",m.miss++,s(3,d=0),O("miss",t.lane)}(e)})}(),function(){const t=Object.values(m).reduce((t,e)=>t+e,0);if(t>0){const e=m.perfect+m.great;s(4,f=Math.round(e/t*100))}}(),b>=1e3*$t?function(){F();const t=Object.values(m).reduce((t,e)=>t+e,0);if(t>0){const e=(3*(m.perfect||0)+2*(m.great||0)+1*(m.good||0))/(3*t)*100;s(4,f=Math.round(e))}try{gt.updateHighScore(l.id,c,u)}catch(e){console.warn("ä¿å­˜é«˜åˆ†è®°å½•å¤±è´¥:",e)}n("gameEnd",{song:l,difficulty:c,score:u,combo:d,maxCombo:h,accuracy:f,judgments:m})}():j=requestAnimationFrame(D)}function T(t){if(!p||v)return;const e=.8*i.offsetHeight,n=g.filter(e=>e.lane===t&&e.createdAt&&!e.hit);if(0===n.length)return;n.sort((t,s)=>Math.abs(t.position-e)-Math.abs(s.position-e));const o=n[0],a=Math.abs(o.position-e);if(a<w+50){const t=function(t){return t<=S?"perfect":t<=$?"great":t<=M?"good":t<=w?"bad":"miss"}(a);if(function(t,e){t.hit=!0,t.judgment=e,m[e]++;const n=N[e],o=Math.min(d/10+1,2),i="miss"!==e?Math.floor(n*o):0;s(2,u+=i),"miss"===e?s(3,d=0):(s(3,d++,d),h=Math.max(h,d));O(e,t.lane)}(o,t),mt){const e=`hit_${t}`;mt.playSoundEffect(e)}}}function O(t,e){const s=.8*i.offsetHeight,n=i.offsetWidth/x,o=e*n+n/2,a=s,l=document.createElement("div");l.className=`judgment ${t}`,l.textContent="perfect"===t?"PERFECT!":"great"===t?"GREAT!":"good"===t?"GOOD":"bad"===t?"BAD":"MISS",l.style.left=`${o}px`,l.style.top=`${a}px`,l.style.transform="translate(-50%, -50%)",i.appendChild(l),setTimeout(()=>{i.contains(l)&&i.removeChild(l)},600)}function z(){s(6,v=!v),v||D()}function F(){p=!1,j&&cancelAnimationFrame(j)}function H(t){T(t)}k(async()=>{r.audioEnabled&&mt.setBGMVolume(.8),r.sfxEnabled&&mt.setSFXVolume(.8),function(){s(5,g=[]);const t=l.difficulty[c].notes,e=1e3;for(let s=0;s<t;s++){const t=Math.floor(Math.random()*x),n=(s+1)*e;g.push({id:s,lane:t,timing:n,hit:!1,judgment:null,position:0,createdAt:null})}}(),await(R(),A),function(){if(!i||!a)return;const t=o.offsetWidth,e=o.offsetHeight;s(9,i.style.width=t+"px",i),s(9,i.style.height=.7*e+"px",i);const n=.8*i.offsetHeight;s(10,a.style.top=n+"px",a)}(),console.log("å¼€å§‹æ’­æ”¾æ­Œæ›²:",l.title),y=Date.now(),p=!0,D()}),E(()=>{F(),mt.stopBGM()});return t.$$set=t=>{"song"in t&&s(0,l=t.song),"difficulty"in t&&s(1,c=t.difficulty),"gameConfig"in t&&s(17,r=t.gameConfig)},[l,c,u,d,f,g,v,b,o,i,a,n,x,C,z,function(t){if(" "===t.key)return t.preventDefault(),void z();const e={d:0,f:1,j:2,k:3,1:0,2:1,3:2,4:3}[t.key.toLowerCase()];void 0!==e&&e<x&&T(e)},H,r,()=>n("exit"),function(t){q[t?"unshift":"push"](()=>{a=t,s(10,a)})},t=>H(t),t=>H(t),function(t){q[t?"unshift":"push"](()=>{i=t,s(9,i)})},()=>n("exit"),function(t){q[t?"unshift":"push"](()=>{o=t,s(8,o)})}]}class kt extends X{constructor(t){super(),K(this,t,wt,St,l,{song:0,difficulty:1,gameConfig:17},null,[-1,-1])}}function Et(t,e,s){const n=t.slice();return n[11]=e[s],n}function _t(t){let e;return{c(){e=f("div"),e.innerHTML='<span class="new-record-text svelte-p7acyn">ğŸ‰ æ–°çºªå½•ï¼</span>',b(e,"class","new-record-banner svelte-p7acyn")},m(t,s){u(t,e,s)},d(t){t&&d(e)}}}function Nt(t){let e,s,n,o,i,a,l,c,h,p,v,x,S,$="perfect"===t[11]?"PERFECT":"great"===t[11]?"GREAT":"good"===t[11]?"GOOD":"bad"===t[11]?"BAD":"MISS",M=(t[0].judgments?t[0].judgments[t[11]]:0)+"";return{c(){e=f("div"),s=f("div"),n=f("span"),o=m($),i=g(),a=f("span"),l=m(M),c=g(),h=f("div"),p=f("div"),v=g(),x=f("span"),x.textContent=`${t[5](t[11])}%`,S=g(),b(n,"class","judgment-name svelte-p7acyn"),C(n,"color",jt(t[11])),b(a,"class","judgment-count svelte-p7acyn"),b(s,"class","judgment-info svelte-p7acyn"),b(p,"class","judgment-fill svelte-p7acyn"),C(p,"width",t[5](t[11])+"%"),C(p,"background-color",jt(t[11])),b(h,"class","judgment-bar svelte-p7acyn"),b(x,"class","judgment-percentage svelte-p7acyn"),b(e,"class","judgment-item svelte-p7acyn")},m(t,d){u(t,e,d),r(e,s),r(s,n),r(n,o),r(s,i),r(s,a),r(a,l),r(e,c),r(e,h),r(h,p),r(e,v),r(e,x),r(e,S)},p(t,e){1&e&&M!==(M=(t[0].judgments?t[0].judgments[t[11]]:0)+"")&&y(l,M)},d(t){t&&d(e)}}}function qt(t){let e,n,o,a,l,c,p,x,S,$,M,w,k,E,_,N,q,j,D,A,T,R,O,z,F,H,V,B,G,L,I,P,J,U,K,X,Q,Y,Z,tt,et,st,nt,ot,it,at,lt,ct,rt,ut,dt,ht=t[0].song.title+"",ft=t[0].song.artist+"",mt=Dt(t[0].difficulty)+"",gt=At(t[0].score)+"",pt=t[0].accuracy+"",vt=t[0].maxCombo+"",bt=t[1]&&_t(),yt=W(["perfect","great","good","bad","miss"]),xt=[];for(let s=0;s<5;s+=1)xt[s]=Nt(Et(t,yt,s));return{c(){e=f("div"),n=f("div"),bt&&bt.c(),o=g(),a=f("div"),l=f("div"),c=f("div"),p=m(t[2]),x=g(),S=f("div"),$=f("h2"),M=m(ht),w=g(),k=f("p"),E=m(ft),_=m(" Â· "),N=m(mt),q=g(),j=f("div"),D=f("div"),A=f("div"),T=f("span"),T.textContent="æ€»åˆ†",R=g(),O=f("span"),z=m(gt),F=g(),H=f("div"),V=f("span"),V.textContent="å‡†ç¡®ç‡",B=g(),G=f("span"),L=m(pt),I=m("%"),P=g(),J=f("div"),U=f("span"),U.textContent="æœ€å¤§è¿å‡»",K=g(),X=f("span"),Q=m(vt),Y=g(),Z=f("div"),tt=f("h3"),tt.textContent="åˆ¤å®šç»Ÿè®¡",et=g(),st=f("div");for(let t=0;t<5;t+=1)xt[t].c();nt=g(),ot=f("div"),it=f("button"),it.textContent="å†ç©ä¸€æ¬¡",at=g(),lt=f("button"),lt.textContent="è¿”å›ä¸»é¡µ",ct=g(),rt=f("div"),rt.innerHTML="<span>åˆ†äº«ä½ çš„æˆç»©ï¼ŒæŒ‘æˆ˜å…¨çƒç©å®¶ï¼</span>",b(c,"class","grade svelte-p7acyn"),C(c,"color",t[3]),b($,"class","song-title svelte-p7acyn"),b(k,"class","song-details svelte-p7acyn"),b(S,"class","song-info svelte-p7acyn"),b(l,"class","grade-section svelte-p7acyn"),b(T,"class","stat-label svelte-p7acyn"),b(O,"class","stat-value svelte-p7acyn"),b(A,"class","stat-item score svelte-p7acyn"),b(V,"class","stat-label svelte-p7acyn"),b(G,"class","stat-value svelte-p7acyn"),b(H,"class","stat-item accuracy svelte-p7acyn"),b(U,"class","stat-label svelte-p7acyn"),b(X,"class","stat-value svelte-p7acyn"),b(J,"class","stat-item combo svelte-p7acyn"),b(D,"class","stat-row svelte-p7acyn"),b(j,"class","main-stats svelte-p7acyn"),b(tt,"class","section-title svelte-p7acyn"),b(st,"class","judgment-list svelte-p7acyn"),b(Z,"class","judgment-stats svelte-p7acyn"),b(it,"class","play-again-button svelte-p7acyn"),b(lt,"class","back-home-button svelte-p7acyn"),b(ot,"class","action-buttons svelte-p7acyn"),b(a,"class","score-card svelte-p7acyn"),b(rt,"class","ranking-tip svelte-p7acyn"),b(n,"class","score-container svelte-p7acyn"),b(e,"class","score-page svelte-p7acyn")},m(s,i){u(s,e,i),r(e,n),bt&&bt.m(n,null),r(n,o),r(n,a),r(a,l),r(l,c),r(c,p),r(l,x),r(l,S),r(S,$),r($,M),r(S,w),r(S,k),r(k,E),r(k,_),r(k,N),r(a,q),r(a,j),r(j,D),r(D,A),r(A,T),r(A,R),r(A,O),r(O,z),r(D,F),r(D,H),r(H,V),r(H,B),r(H,G),r(G,L),r(G,I),r(D,P),r(D,J),r(J,U),r(J,K),r(J,X),r(X,Q),r(a,Y),r(a,Z),r(Z,tt),r(Z,et),r(Z,st);for(let t=0;t<5;t+=1)xt[t]&&xt[t].m(st,null);r(a,nt),r(a,ot),r(ot,it),r(ot,at),r(ot,lt),r(n,ct),r(n,rt),ut||(dt=[v(it,"click",t[6]),v(lt,"click",t[7])],ut=!0)},p(t,[e]){if(t[1]?bt||(bt=_t(),bt.c(),bt.m(n,o)):bt&&(bt.d(1),bt=null),4&e&&y(p,t[2]),8&e&&C(c,"color",t[3]),1&e&&ht!==(ht=t[0].song.title+"")&&y(M,ht),1&e&&ft!==(ft=t[0].song.artist+"")&&y(E,ft),1&e&&mt!==(mt=Dt(t[0].difficulty)+"")&&y(N,mt),1&e&&gt!==(gt=At(t[0].score)+"")&&y(z,gt),1&e&&pt!==(pt=t[0].accuracy+"")&&y(L,pt),1&e&&vt!==(vt=t[0].maxCombo+"")&&y(Q,vt),33&e){let s;for(yt=W(["perfect","great","good","bad","miss"]),s=0;s<5;s+=1){const n=Et(t,yt,s);xt[s]?xt[s].p(n,e):(xt[s]=Nt(n),xt[s].c(),xt[s].m(st,null))}for(;s<5;s+=1)xt[s].d(1)}},i:s,o:s,d(t){t&&d(e),bt&&bt.d(),h(xt,t),ut=!1,i(dt)}}}function jt(t){return{perfect:"var(--judgment-perfect)",great:"var(--judgment-great)",good:"var(--judgment-good)",bad:"var(--judgment-bad)",miss:"var(--judgment-miss)"}[t]||"#ffffff"}function Dt(t){return{easy:"ç®€å•",medium:"ä¸­ç­‰",hard:"å›°éš¾"}[t]||t}function At(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Tt(t,e,s){const n=_();let{results:o}=e,i=!1,a=0,l="F",c="#ff0000";k(()=>{a=Object.values(o.judgments||{}).reduce((t,e)=>t+e,0),function(){try{const t=JSON.parse(localStorage.getItem("rhythmMasterHighScores")||"{}"),e=`${o.song.id}_${o.difficulty}`;s(1,i=t[e]===o.score)}catch(t){console.error("æ£€æŸ¥æœ€é«˜åˆ†å¤±è´¥:",t)}}(),function(){const t=o.accuracy||0,e=o.judgments?o.judgments.perfect/a*100:0;t>=98&&e>=90?(s(2,l="SSS"),s(3,c="#ffaa00")):t>=95?(s(2,l="SS"),s(3,c="#ff8800")):t>=90?(s(2,l="S"),s(3,c="#ff6600")):t>=80?(s(2,l="A"),s(3,c="#00ff88")):t>=70?(s(2,l="B"),s(3,c="#00bfff")):t>=60?(s(2,l="C"),s(3,c="#ffff00")):t>=50?(s(2,l="D"),s(3,c="#ff8800")):(s(2,l="F"),s(3,c="#ff0000"))}()});return t.$$set=t=>{"results"in t&&s(0,o=t.results)},[o,i,l,c,n,function(t){return o.judgments&&0!==a?Math.round(o.judgments[t]/a*100):0},()=>n("playAgain"),()=>n("backHome")]}class Rt extends X{constructor(t){super(),K(this,t,Tt,qt,l,{results:0})}}function Ot(t){let e,n,o,a,l,h,p,C,$,M,w,k,E,_,N,q,j,D,A,T,R,O,z,F,H,V,B,G,L,I,W,P,J,U,K,X,Q,Y,Z,tt,et,st,nt,ot,it,at,lt,ct,rt,ut,dt,ht,ft,mt,gt,pt,vt,bt,yt,xt,Ct,St,$t,Mt,wt,kt,Et,_t,Nt,qt,jt,Dt,At,Tt,Rt,Ot,zt,Ft,Ht,Vt,Bt=Math.round(100*t[0].audioVolume)+"",Gt=Math.round(100*t[0].sfxVolume)+"",Lt=t[0].speed+"",It=t[0].noteRadius+"";return{c(){e=f("div"),n=f("header"),o=f("h1"),o.textContent="æ¸¸æˆè®¾ç½®",a=g(),l=f("button"),l.textContent="â† è¿”å›",h=g(),p=f("div"),C=f("section"),$=f("h2"),$.textContent="ğŸ”Š éŸ³é¢‘è®¾ç½®",M=g(),w=f("div"),k=f("div"),E=f("label"),_=f("input"),q=m("\n            èƒŒæ™¯éŸ³ä¹"),j=g(),D=f("div"),A=f("label"),T=f("input"),O=m("\n            éŸ³æ•ˆ"),z=g(),F=f("div"),H=f("label"),H.textContent="èƒŒæ™¯éŸ³ä¹éŸ³é‡",V=g(),B=f("input"),L=g(),I=f("span"),W=m(Bt),P=m("%"),J=g(),U=f("div"),K=f("label"),K.textContent="éŸ³æ•ˆéŸ³é‡",X=g(),Q=f("input"),Z=g(),tt=f("span"),et=m(Gt),st=m("%"),nt=g(),ot=f("section"),it=f("h2"),it.textContent="ğŸ® æ¸¸æˆè®¾ç½®",at=g(),lt=f("div"),ct=f("div"),rt=f("label"),rt.textContent="æ¸¸æˆé€Ÿåº¦ (éŸ³ç¬¦ä¸‹è½é€Ÿåº¦)",ut=g(),dt=f("input"),ft=g(),mt=f("span"),gt=m(Lt),pt=g(),vt=f("div"),bt=f("label"),bt.textContent="éŸ³ç¬¦å¤§å°",yt=g(),xt=f("input"),St=g(),$t=f("span"),Mt=m(It),wt=g(),kt=f("div"),Et=f("label"),Et.textContent="è½¨é“æ•°é‡",_t=g(),Nt=f("select"),qt=f("option"),qt.textContent="4è½¨é“ (æ ‡å‡†)",jt=f("option"),jt.textContent="6è½¨é“ (è¿›é˜¶)",At=g(),Tt=f("section"),Rt=f("button"),Rt.textContent="ğŸ”„ é‡ç½®æ‰€æœ‰è®¾ç½®",Ot=g(),zt=f("section"),zt.innerHTML='<h2 class="section-title svelte-1ucveqb">ğŸ“– å…³äºæ¸¸æˆ</h2> <div class="about-info svelte-1ucveqb"><p class="svelte-1ucveqb">èŠ‚å¥å¤§å¸ˆ (Rhythm Master) v1.0.0</p> <p class="svelte-1ucveqb">ä¸€ä¸ªæœ‰è¶£çš„éŸ³ä¹èŠ‚å¥æ¸¸æˆï¼Œè€ƒéªŒä½ çš„ååº”é€Ÿåº¦å’ŒèŠ‚å¥æ„Ÿï¼</p> <p class="svelte-1ucveqb">Â© 2024 Rhythm Master Team</p></div>',b(o,"class","settings-title svelte-1ucveqb"),b(l,"class","back-button svelte-1ucveqb"),b(n,"class","settings-header svelte-1ucveqb"),b($,"class","section-title svelte-1ucveqb"),b(_,"type","checkbox"),_.checked=N=t[0].audioEnabled,b(_,"class","svelte-1ucveqb"),b(E,"class","setting-label svelte-1ucveqb"),b(k,"class","setting-item svelte-1ucveqb"),b(T,"type","checkbox"),T.checked=R=t[0].sfxEnabled,b(T,"class","svelte-1ucveqb"),b(A,"class","setting-label svelte-1ucveqb"),b(D,"class","setting-item svelte-1ucveqb"),b(H,"class","setting-label svelte-1ucveqb"),b(B,"type","range"),b(B,"min","0"),b(B,"max","1"),b(B,"step","0.05"),B.value=G=t[0].audioVolume,b(B,"class","svelte-1ucveqb"),b(I,"class","slider-value svelte-1ucveqb"),b(F,"class","setting-item slider svelte-1ucveqb"),b(K,"class","setting-label svelte-1ucveqb"),b(Q,"type","range"),b(Q,"min","0"),b(Q,"max","1"),b(Q,"step","0.05"),Q.value=Y=t[0].sfxVolume,b(Q,"class","svelte-1ucveqb"),b(tt,"class","slider-value svelte-1ucveqb"),b(U,"class","setting-item slider svelte-1ucveqb"),b(w,"class","settings-group svelte-1ucveqb"),b(C,"class","settings-section svelte-1ucveqb"),b(it,"class","section-title svelte-1ucveqb"),b(rt,"class","setting-label svelte-1ucveqb"),b(dt,"type","range"),b(dt,"min","5"),b(dt,"max","20"),b(dt,"step","1"),dt.value=ht=t[0].speed,b(dt,"class","svelte-1ucveqb"),b(mt,"class","slider-value svelte-1ucveqb"),b(ct,"class","setting-item slider svelte-1ucveqb"),b(bt,"class","setting-label svelte-1ucveqb"),b(xt,"type","range"),b(xt,"min","10"),b(xt,"max","30"),b(xt,"step","1"),xt.value=Ct=t[0].noteRadius,b(xt,"class","svelte-1ucveqb"),b($t,"class","slider-value svelte-1ucveqb"),b(vt,"class","setting-item slider svelte-1ucveqb"),b(Et,"class","setting-label svelte-1ucveqb"),qt.__value="4",x(qt,qt.__value),b(qt,"class","svelte-1ucveqb"),jt.__value="6",x(jt,jt.__value),b(jt,"class","svelte-1ucveqb"),b(Nt,"class","svelte-1ucveqb"),b(kt,"class","setting-item select svelte-1ucveqb"),b(lt,"class","settings-group svelte-1ucveqb"),b(ot,"class","settings-section svelte-1ucveqb"),b(Rt,"class","reset-button svelte-1ucveqb"),b(Tt,"class","settings-section svelte-1ucveqb"),b(zt,"class","settings-section about svelte-1ucveqb"),b(p,"class","settings-container svelte-1ucveqb"),b(e,"class",Ft=c("settings-page "+(t[1]?"fade-in":""))+" svelte-1ucveqb")},m(s,i){u(s,e,i),r(e,n),r(n,o),r(n,a),r(n,l),r(e,h),r(e,p),r(p,C),r(C,$),r(C,M),r(C,w),r(w,k),r(k,E),r(E,_),r(E,q),r(w,j),r(w,D),r(D,A),r(A,T),r(A,O),r(w,z),r(w,F),r(F,H),r(F,V),r(F,B),r(F,L),r(F,I),r(I,W),r(I,P),r(w,J),r(w,U),r(U,K),r(U,X),r(U,Q),r(U,Z),r(U,tt),r(tt,et),r(tt,st),r(p,nt),r(p,ot),r(ot,it),r(ot,at),r(ot,lt),r(lt,ct),r(ct,rt),r(ct,ut),r(ct,dt),r(ct,ft),r(ct,mt),r(mt,gt),r(lt,pt),r(lt,vt),r(vt,bt),r(vt,yt),r(vt,xt),r(vt,St),r(vt,$t),r($t,Mt),r(lt,wt),r(lt,kt),r(kt,Et),r(kt,_t),r(kt,Nt),r(Nt,qt),r(Nt,jt),S(Nt,t[0].laneCount),r(p,At),r(p,Tt),r(Tt,Rt),r(p,Ot),r(p,zt),Ht||(Vt=[v(l,"click",t[6]),v(_,"change",t[7]),v(T,"change",t[8]),v(B,"input",t[9]),v(Q,"input",t[10]),v(dt,"input",t[11]),v(xt,"input",t[12]),v(Nt,"change",t[13]),v(Rt,"click",t[4])],Ht=!0)},p(t,[s]){1&s&&N!==(N=t[0].audioEnabled)&&(_.checked=N),1&s&&R!==(R=t[0].sfxEnabled)&&(T.checked=R),1&s&&G!==(G=t[0].audioVolume)&&(B.value=G),1&s&&Bt!==(Bt=Math.round(100*t[0].audioVolume)+"")&&y(W,Bt),1&s&&Y!==(Y=t[0].sfxVolume)&&(Q.value=Y),1&s&&Gt!==(Gt=Math.round(100*t[0].sfxVolume)+"")&&y(et,Gt),1&s&&ht!==(ht=t[0].speed)&&(dt.value=ht),1&s&&Lt!==(Lt=t[0].speed+"")&&y(gt,Lt),1&s&&Ct!==(Ct=t[0].noteRadius)&&(xt.value=Ct),1&s&&It!==(It=t[0].noteRadius+"")&&y(Mt,It),1&s&&Dt!==(Dt=t[0].laneCount)&&S(Nt,t[0].laneCount),2&s&&Ft!==(Ft=c("settings-page "+(t[1]?"fade-in":""))+" svelte-1ucveqb")&&b(e,"class",Ft)},i:s,o:s,d(t){t&&d(e),Ht=!1,i(Vt)}}}function zt(t,e,s){const n=_();let{gameConfig:o}=e,i={audioEnabled:!0,sfxEnabled:!0,audioVolume:.8,sfxVolume:.8,laneCount:4,speed:10,noteRadius:20,difficulty:"easy",fullscreen:!1,keyBindings:"default"},a=!1;function l(){s(0,i.fullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement),i)}function c(t,e){s(0,i[t]=e,i),n("updateConfig",i)}k(()=>{s(0,i={...i,...o}),setTimeout(()=>{s(1,a=!0)},100),l(),document.addEventListener("fullscreenchange",l)}),E(()=>{document.removeEventListener("fullscreenchange",l)});return t.$$set=t=>{"gameConfig"in t&&s(5,o=t.gameConfig)},[i,a,n,c,function(){confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®åˆ°é»˜è®¤å€¼å—ï¼Ÿ")&&(s(0,i={audioEnabled:!0,sfxEnabled:!0,audioVolume:.8,sfxVolume:.8,laneCount:4,speed:10,noteRadius:20,difficulty:"easy",fullscreen:i.fullscreen,keyBindings:"default"}),n("updateConfig",i))},o,()=>n("back"),t=>c("audioEnabled",t.target.checked),t=>c("sfxEnabled",t.target.checked),t=>c("audioVolume",parseFloat(t.target.value)),t=>c("sfxVolume",parseFloat(t.target.value)),t=>c("speed",parseInt(t.target.value)),t=>c("noteRadius",parseInt(t.target.value)),t=>c("laneCount",parseInt(t.target.value))]}class Ft extends X{constructor(t){super(),K(this,t,zt,Ot,l,{gameConfig:5})}}function Ht(t){let e,s;return e=new Ft({props:{gameConfig:t[4]}}),e.$on("updateConfig",t[15]),e.$on("back",t[16]),{c(){P(e.$$.fragment)},m(t,n){J(e,t,n),s=!0},p(t,s){const n={};16&s&&(n.gameConfig=t[4]),e.$set(n)},i(t){s||(L(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){U(e,t)}}}function Vt(t){let e,s;return e=new Rt({props:{results:t[3]}}),e.$on("playAgain",t[13]),e.$on("backHome",t[14]),{c(){P(e.$$.fragment)},m(t,n){J(e,t,n),s=!0},p(t,s){const n={};8&s&&(n.results=t[3]),e.$set(n)},i(t){s||(L(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){U(e,t)}}}function Bt(t){let e,s;return e=new kt({props:{song:t[1],difficulty:t[2],gameConfig:t[4]}}),e.$on("gameEnd",t[11]),e.$on("exit",t[12]),{c(){P(e.$$.fragment)},m(t,n){J(e,t,n),s=!0},p(t,s){const n={};2&s&&(n.song=t[1]),4&s&&(n.difficulty=t[2]),16&s&&(n.gameConfig=t[4]),e.$set(n)},i(t){s||(L(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){U(e,t)}}}function Gt(t){let e,s;return e=new ft({props:{gameConfig:t[4]}}),e.$on("startGame",t[9]),e.$on("settings",t[10]),{c(){P(e.$$.fragment)},m(t,n){J(e,t,n),s=!0},p(t,s){const n={};16&s&&(n.gameConfig=t[4]),e.$set(n)},i(t){s||(L(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){U(e,t)}}}function Lt(t){let e,s,n,o;const a=[Gt,Bt,Vt,Ht],l=[];function c(t,e){return"home"===t[0]?0:"game"===t[0]?1:"score"===t[0]?2:"settings"===t[0]?3:-1}return~(s=c(t))&&(n=l[s]=a[s](t)),{c(){e=f("div"),n&&n.c(),b(e,"class","app-container svelte-1yp99rx")},m(t,n){u(t,e,n),~s&&l[s].m(e,null),o=!0},p(t,[o]){let r=s;s=c(t),s===r?~s&&l[s].p(t,o):(n&&(G={r:0,c:[],p:G},I(l[r],1,1,()=>{l[r]=null}),G.r||i(G.c),G=G.p),~s?(n=l[s],n?n.p(t,o):(n=l[s]=a[s](t),n.c()),L(n,1),n.m(e,null)):n=null)},i(t){o||(L(n),o=!0)},o(t){I(n),o=!1},d(t){t&&d(e),~s&&l[s].d()}}}function It(t,e,s){let n="home",o=null,i="easy",a=null,l={laneCount:4,speed:10,noteRadius:20,audioEnabled:!0,sfxEnabled:!0,difficulty:"easy"};function c(t){s(0,n=t)}function r(t,e){s(1,o=t),s(2,i=e),s(4,l.difficulty=e,l),s(3,a=null),c("game")}function u(t){s(3,a=t),c("score")}function d(t){s(4,l={...l,...t}),localStorage.setItem("rhythmMasterConfig",JSON.stringify(l)),mt&&(mt.setVolume(t.audioVolume||1),mt.setSfxEnabled(t.sfxEnabled))}function h(t){"Escape"===t.key&&"home"!==n&&("game"===n?confirm("ç¡®å®šè¦é€€å‡ºæ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚")&&c("home"):c("home"))}k(()=>{mt.isSupported||console.warn("æµè§ˆå™¨ä¸æ”¯æŒWeb Audio APIï¼Œæ¸¸æˆä½“éªŒå¯èƒ½å—é™"),window.addEventListener("keydown",h);const t=localStorage.getItem("rhythmMasterConfig");if(t)try{const e=JSON.parse(t);s(4,l={...l,...e})}catch(e){console.error("åŠ è½½é…ç½®å¤±è´¥:",e)}}),E(()=>{window.removeEventListener("keydown",h),localStorage.setItem("rhythmMasterConfig",JSON.stringify(l)),mt&&mt.cleanup()});return[n,o,i,a,l,c,r,u,d,({detail:{song:t,difficulty:e}})=>r(t,e),()=>c("settings"),({detail:t})=>u(t),()=>c("home"),()=>r(o,i),()=>c("home"),({detail:t})=>d(t),()=>c("home")]}new class extends X{constructor(t){super(),K(this,t,It,Lt,l,{})}}({target:document.getElementById("app")});
